---
import { CLASSES } from "../classes";
import { THEME_STORAGE_KEY } from "../consts";
import { ICONS } from "../styles";
---

<button
  id="theme-toggle"
  type="button"
  class={CLASSES.visual.themeToggle}
  aria-label="Toggle Dark Mode"
>
  <svg
    class="w-6 h-6"
    viewBox="0 0 20 20"
    fill="currentColor"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path d={ICONS.moon} class="translate-x-[-1px]"></path>
    <path 
      d={ICONS.sun} 
      class="opacity-40" 
      fill-rule="evenodd" 
      clip-rule="evenodd"
    ></path>
  </svg>
</button>

<script define:vars={{ THEME_STORAGE_KEY }}>
  const setupThemeToggle = () => {
    const themeToggleBtn = document.getElementById('theme-toggle');
    if (!themeToggleBtn) return;

    themeToggleBtn.addEventListener('click', () => {
      const isDark = document.documentElement.classList.contains('dark');
      const newTheme = isDark ? 'light' : 'dark';
      
      if (newTheme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      
      localStorage.setItem(THEME_STORAGE_KEY, newTheme);
    });
  };

  // Run on initial load and after every navigation
  document.addEventListener('astro:page-load', setupThemeToggle);
</script>